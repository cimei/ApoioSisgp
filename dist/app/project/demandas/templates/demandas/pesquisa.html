{% extends "base.html" %}
{% block content %}

<div class="container">

<div class="jumbotron">
  <div class="">
    <h5>Resultado de procura</h5>
    <p><span class="badge badge-primary badge-pill">{{demandas_count}}</span> demandas encontradas  - pág. {{demandas.page}} de {{demandas.pages}}</p>
    <span>Filtro utilizado:</span>
      <ul class="list-inline">
       <li class="list-inline-item">Coord: {% if pesq_l[9] == "%" %}Vazio{% else %} <mark>{{pesq_l[9]}}</mark>{% endif %} </li>
       <li class="list-inline-item">Demanda: {% if pesq_l[7] == "%%" %}Vazio{% else %} <mark>{{pesq_l[7]}}</mark>{% endif %} </li>
       <li class="list-inline-item">Programa: {% if pesq_l[8] == ""%}Vazio{% else %} <mark>{{pesq_l[8]}}</mark>{% endif %} </li>
       <li class="list-inline-item">SEI: {% if pesq_l[0] == ""%}Vazio{% else %} <mark>{{pesq_l[0]}}</mark>{% endif %} </li>
       <li class="list-inline-item">Convênio: {% if pesq_l[5] == ""%} Vazio{% else %} <mark>{{pesq_l[5]}}</mark>{% endif %} </li>
       <li class="list-inline-item">Título: {% if pesq_l[1] == ""%} Vazio{% else %} <mark>{{pesq_l[1]}}</mark>{% endif %} </li>
       <li class="list-inline-item">Resp.: {% if pesq_l[6] == ""%} Vazio{% else %} <mark>{{pesq_l[6]}}</mark>{% endif %} </li>
       <li class="list-inline-item">Tipo: {% if pesq_l[2] == "Todos"%} Todos{% else %} <mark>{{pesq_l[2]}}</mark>{% endif %} </li>
       <li class="list-inline-item">Aguarda despacho: {% if pesq_l[3] == "Sim"%} <mark>Não</mark>
                                                    {% elif pesq_l[3] == "Não"%} <mark>Sim</mark>
                                                    {% else %} {{pesq_l[3]}}{% endif %} </li>
       <li class="list-inline-item">Aguarda despacho CG: {% if pesq_l[10] == "Sim"%} <mark>Não</mark>
                                                   {% elif pesq_l[10] == "Não"%} <mark>Sim</mark>
                                                   {% else %} {{pesq_l[10]}}{% endif %} </li>
       <li class="list-inline-item">Concluído: {% if pesq_l[4] == "Sim"%} <mark>Não</mark>
                                                    {% elif pesq_l[4] == "Não"%} <mark>Sim</mark>
                                                    {% else %} {{pesq_l[4]}}{% endif %} </li>
    </ul>
  </div>

  {% for demanda in demandas.items %}

    <div class="row">

    <div class="col-sm">
      <div class="card">
        <div class="card-body">
          <span>Demanda: {{demanda.id}} ({{demanda.author.coord}}) - {{demanda.programa}}</span>
          <h4><a class="card-title" href="{{url_for('demandas.demanda',demanda_id=demanda.id)}}">{{demanda.titulo}}</a></h4>
          <p>Tipo: {{demanda.tipo}}</p>
          <p>Referente ao processo SEI: {{demanda.sei}}
            {% if demanda.convênio != None %}({{demanda.convênio}}{% if demanda.ano_convênio != None %}/{{demanda.ano_convênio}}{% endif %}{% endif %})
          </p>
          Responsável: <a href="{{url_for('users.user_posts',username=demanda.author.username,filtro='*')}}">{{demanda.author.username}}</a>
          <p>Em: {{demanda.data.strftime('%x')}}</p>
            {% if demanda.necessita_despacho == True %}
              <h5 class="text-warning">Aguarda despacho
                {% if demanda.data_env_despacho != None %}
                  desde {{demanda.data_env_despacho.strftime('%x')}}
                {% endif %}
              </h5>
            {% endif %}
            {% if demanda.necessita_despacho_cg == True %}
              <h5 class="text-info">Aguarda despacho CG ou sup.
                {% if demanda.data_env_despacho != None %}
                  desde {{demanda.data_env_despacho.strftime('%x')}}
                {% endif %}
              </h5>
            {% endif %}
            {% if demanda.conclu == False %}
              <h5>Em andamento</h5>
            {% else %}
              <h5 class="text-success">Concluído {{demanda.data_conclu.strftime('%x')}}</h5>
            {% endif %}
          <a href="{{url_for('demandas.demanda',demanda_id=demanda.id)}}" class="card-link">Ler a demanda</a>
        </div>
      </div>
    </div>

    <div class="col-sm">
      <div class="card bg-light mb-3">
        <div class="card-header">Providências e Despachos</div>
        <div class="card-body">
          <div class="list-group">
          {% for item in pro_des %}
            {% if item.demanda_id == demanda.id %}
              <div class="list-group-item list-group-item-action">
                <p class="card-text">{{item.texto}}</p>
                {% if item.username[-8:-1] == 'DESPACH' %}
                  {% if item.despacha2 == True and item.despacha == False %}
                    <p class="card-text"><small class="text-muted">Em: {{item.data.strftime('%x')}}
                      <span class="text-danger"><b>({{item.username}})</b></span></small></p>
                  {% else %}
                    <p class="card-text"><small class="text-muted">Em: {{item.data.strftime('%x')}}
                      <span class="text-success"><b>({{item.username}})</b></span></small></p>
                  {% endif %}
                {% else %}
                  <p class="card-text"><small class="text-muted">Em: {{item.data.strftime('%x')}}
                    <span class="text-info">({{item.username}})</span></small></p>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
        </div>
      </div>
    </div>

    </div>

    <div class="row">
      <p>...</p>
    </div>

  {% endfor %}


  </div>
</div>

<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">

    {% for page_num in demandas.iter_pages(left_edge=1,left_current=1,right_current=2,right_edge=1) %}
      {% if page_num %}
        {% if demandas.page == page_num %}
          <li class="page-item active">
              <a class="page-link" href="{{url_for('demandas.list_pesquisa',pesq=pesq,page=page_num)}}">{{page_num}}</a>
          </li>
        {% else %}
          <li class="page-item">
              <a class="page-link" href="{{url_for('demandas.list_pesquisa',pesq=pesq,page=page_num)}}">{{page_num}}</a>
          </li>
        {% endif %}
      {% else %}
        <span class="page-link">…</span>
      {% endif %}
    {% endfor %}

  </ul>
</nav>

{% endblock %}
